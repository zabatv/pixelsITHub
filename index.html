<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Art Multiplayer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #000;
            text-align: center;
        }
        .tools {
            margin-top: 20px;
        }
        .tools input, .tools button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(100, 10px); /* 1000 –ø–∏–∫—Å–µ–ª–µ–π */
            grid-gap: 1px;
            justify-content: center;
            margin-top: 20px;
        }
        .pixel {
            width: 10px;
            height: 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        .cooldown {
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>üé® Pixel Art Multiplayer</h1>

    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
    <div class="tools">
        <label for="colorPicker">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç:</label>
        <input type="color" id="colorPicker" value="#ffffff">

        <button id="eyedropperButton">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∏–ø–µ—Ç–∫—É</button>
    </div>

    <!-- –°–µ—Ç–∫–∞ –ø–∏–∫—Å–µ–ª–µ–π -->
    <div class="grid" id="pixelGrid"></div>
    <div class="cooldown" id="cooldownMessage"></div>

    <!-- Firebase SDK + –õ–æ–≥–∏–∫–∞ -->
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Firebase SDK —á–µ—Ä–µ–∑ CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

        // –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ!)
        const firebaseConfig = {
            apiKey: "AIzaSyBqyirSy0rIxj_VygUR_0dXPHvdR0LYZc0", // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
            authDomain: "pixelsithub.firebaseapp.com",          // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
            projectId: "pixelsithub",                           // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
            storageBucket: "pixelsithub.appspot.com",           // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
            messagingSenderId: "367605301479",                  // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
            appId: "1:367605301479:web:fc444cb9fb04c2fd8b6242", // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
            measurementId: "G-WWDH0PNVJY"                       // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // --- –õ–û–ì–ò–ö–ê –ü–ò–ö–°–ï–õ–¨–ù–û–ì–û –ò–°–ö–£–°–°–¢–í–ê ---

        const gridSize = 100; // –†–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ 100x100 (1000 –ø–∏–∫—Å–µ–ª–µ–π)
        let cooldown = false;
        let selectedColor = '#ffffff'; // –¶–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∫–∏
        function createGrid() {
            const gridElement = document.getElementById('pixelGrid');
            for (let i = 0; i < gridSize * gridSize; i++) {
                const pixel = document.createElement('div');
                pixel.classList.add('pixel');
                pixel.dataset.index = i;
                pixel.addEventListener('click', handlePixelClick);
                gridElement.appendChild(pixel);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –ø–∏–∫—Å–µ–ª—é
        function handlePixelClick(event) {
            if (cooldown) {
                alert('–ü–æ–¥–æ–∂–¥–∏—Ç–µ 15 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º.');
                return;
            }

            const index = event.target.dataset.index;

            // –û—Ç–ª–∞–¥–∫–∞: –≤—ã–≤–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç
            console.log('–ö–ª–∏–∫ –ø–æ –ø–∏–∫—Å–µ–ª—é:', index, '–¶–≤–µ—Ç:', selectedColor);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–≤–µ—Ç –≤ Firebase
            set(ref(database, `pixels/${index}`), selectedColor);

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–∂–∏–¥–∞–Ω–∏—è
            startCooldown();
        }

        // –¢–∞–π–º–µ—Ä –æ–∂–∏–¥–∞–Ω–∏—è
        function startCooldown() {
            cooldown = true;
            document.getElementById('cooldownMessage').textContent = '–ü–æ–¥–æ–∂–¥–∏—Ç–µ 15 –º–∏–Ω—É—Ç...';
            setTimeout(() => {
                cooldown = false;
                document.getElementById('cooldownMessage').textContent = '';
            }, 15 * 60 * 1000); // 15 –º–∏–Ω—É—Ç
        }

        // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã
        document.getElementById('colorPicker').addEventListener('input', (event) => {
            selectedColor = event.target.value;
            console.log('–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç:', selectedColor); // –û—Ç–ª–∞–¥–∫–∞
        });

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∏–ø–µ—Ç–∫–∏
        document.getElementById('eyedropperButton').addEventListener('click', async () => {
            if (!window.EyeDropper) {
                alert('–ü–∏–ø–µ—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Chrome/Edge');
                return;
            }
            try {
                const eyeDropper = new EyeDropper();
                const result = await eyeDropper.open();
                selectedColor = result.sRGBHex;
                document.getElementById('colorPicker').value = selectedColor;
                console.log('–¶–≤–µ—Ç –≤—ã–±—Ä–∞–Ω –ø–∏–ø–µ—Ç–∫–æ–π:', selectedColor); // –û—Ç–ª–∞–¥–∫–∞
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∏–ø–µ—Ç–∫–∏:', error);
            }
        });

        // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Firebase
        onValue(ref(database, 'pixels'), (snapshot) => {
            const pixels = snapshot.val();
            if (pixels) {
                Object.entries(pixels).forEach(([index, color]) => {
                    const pixel = document.querySelector(`.pixel[data-index="${index}"]`);
                    if (pixel) {
                        pixel.style.backgroundColor = color;
                        console.log('–û–±–Ω–æ–≤–ª–µ–Ω –ø–∏–∫—Å–µ–ª—å:', index, '–¶–≤–µ—Ç:', color); // –û—Ç–ª–∞–¥–∫–∞
                    }
                });
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        createGrid();
    </script>
</body>
</html>
